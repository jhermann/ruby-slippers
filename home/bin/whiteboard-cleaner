#! /usr/bin/env bash
#
# Source: https://gist.github.com/lelandbatey/8677901
#
set -e

if test $# -eq 0 -o "$1" = '-h' -o "$1" = '--help'; then
    cat <<-...
	usage: $(basename $0) ‹image›…

	Clean up pictures of whiteboard / flipboard scribbles
	using ImageMagick ('convert' needs to be on the PATH).
	...
    exit 1
fi

skip() {
    echo "$1 $2, skipping…"
    continue
}

for img in "$@"; do
    cleaned="${img%.*}-clean.${img##*.}"
    test "${img##*-clean.}" = "$img" || continue
    test ! -f "$cleaned" || skip "$img" "already cleaned"

    echo "$img…"
    convert -morphology Convolve DoG:15,100,0 -negate -normalize \
            -blur 0x1 -channel RBG -level 60%,91%,0.1 \
            "$img" "$cleaned"
done
